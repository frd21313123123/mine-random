<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор Спидрана Minecraft 1.21 (GIGA)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'VT323', monospace;
            background-image: url('https://assets.codepen.io/13471/dirt-bg.jpg');
            background-size: 128px;
            image-rendering: pixelated;
        }

        .mc-btn {
            background-color: #7d7d7d;
            border: 4px solid #000;
            border-top-color: #a0a0a0;
            border-left-color: #a0a0a0;
            border-right-color: #3f3f3f;
            border-bottom-color: #3f3f3f;
            color: #fff;
            text-shadow: 2px 2px #000;
            transition: all 0.1s;
        }

        .mc-btn:active {
            border-top-color: #3f3f3f;
            border-left-color: #3f3f3f;
            border-right-color: #a0a0a0;
            border-bottom-color: #a0a0a0;
            transform: translateY(2px);
        }

        .mc-panel {
            background-color: #c6c6c6;
            border: 4px solid #000;
            border-top-color: #fff;
            border-left-color: #fff;
            border-right-color: #555;
            border-bottom-color: #555;
            box-shadow: 10px 10px 0px rgba(0, 0, 0, 0.5);
        }

        .mc-slot {
            background-color: #8b8b8b;
            border: 3px solid #373737;
            border-bottom-color: #fff;
            border-right-color: #fff;
            box-shadow: inset 2px 2px 0 #000;
        }

        .timer-screen {
            background-color: #212121;
            border: 3px solid #5d5d5d;
            border-right-color: #fff;
            border-bottom-color: #fff;
            box-shadow: inset 2px 2px 0 #000;
            color: #e25858;
            /* Redstone red */
        }

        .pixel-text {
            text-shadow: 2px 2px 0 #3f3f3f;
        }

        /* Modal Styles */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(2px);
        }

        /* Scrollbar for modal */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #212121;
        }

        ::-webkit-scrollbar-thumb {
            background: #7d7d7d;
            border: 2px solid #3f3f3f;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0a0a0;
        }

        /* Animation classes */
        @keyframes popIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .pop-in {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modifier-box {
            background-color: #1a1a1a;
            border: 2px solid #fff;
            color: #ffff55;
            /* Minecraft Yellow */
            text-shadow: 2px 2px 0 #000;
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

    <div class="mc-panel w-full max-w-md p-6 flex flex-col items-center relative z-10">
        <!-- Header -->
        <h1 class="text-4xl text-center mb-6 text-gray-800" style="text-shadow: 2px 2px 0 #fff;">
            РАНДОМАЙЗЕР 1.21
        </h1>

        <!-- Display Area -->
        <div class="mc-slot w-48 h-48 flex items-center justify-center mb-6 bg-gray-600 relative overflow-hidden group">
            <img id="block-image" src="https://api.mineatar.io/cube/grass_block" alt="Item Preview"
                class="w-32 h-32 object-contain image-rendering-pixelated transition-transform duration-200"
                style="image-rendering: pixelated;">
            <div id="loader"
                class="hidden absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-2xl">
                ...
            </div>
        </div>

        <!-- Info Area -->
        <div class="w-full text-center mb-6 space-y-2">
            <h2 id="block-name"
                class="text-3xl font-bold text-gray-800 drop-shadow-md leading-none min-h-[3rem] flex items-center justify-center">
                Трава</h2>
            <div class="flex items-center justify-center gap-2 flex-wrap">
                <code id="block-id"
                    class="bg-black text-white px-3 py-1 text-lg rounded border-2 border-gray-500 max-w-[280px] break-all">minecraft:grass_block</code>
                <button onclick="copyId()" class="mc-btn px-2 py-1 text-sm flex-shrink-0" title="Скопировать ID">
                    📋
                </button>
            </div>
            <div id="item-type" class="text-gray-600 text-sm font-bold uppercase tracking-widest">БЛОК</div>
        </div>

        <!-- Controls -->
        <div class="w-full flex gap-2 mb-2">
            <button id="roll-btn" onclick="startRoulette('all')"
                class="mc-btn flex-1 py-3 text-2xl hover:bg-gray-400 leading-tight">
                ХАРДКОР<br><span class="text-sm">ВСЕ ПРЕДМЕТЫ</span>
            </button>
            <button id="roll-fast-btn" onclick="startRoulette('fast')"
                class="mc-btn flex-1 py-3 text-2xl hover:bg-gray-400 leading-tight">
                БЫСТРАЯ<br><span class="text-sm">ДО 10 МИН</span>
            </button>
        </div>

        <button onclick="toggleModal()" class="mc-btn w-full py-2 text-xl mb-4 hover:bg-gray-400">
            СПИСОК ПРЕДМЕТОВ
        </button>

        <!-- Timer Section -->
        <div class="w-full mb-4 flex flex-col items-center gap-2">
            <div class="timer-screen w-full py-2 px-4 text-center overflow-hidden">
                <span id="timer-display"
                    class="text-5xl font-mono tracking-widest drop-shadow-md whitespace-nowrap">00:00:00</span>
            </div>
            <div class="flex w-full gap-2">
                <button id="timer-toggle-btn" onclick="toggleTimer()"
                    class="mc-btn flex-1 py-2 text-xl hover:bg-gray-400">СТАРТ</button>
                <button onclick="resetTimer()" class="mc-btn flex-1 py-2 text-xl hover:bg-gray-400">СБРОС</button>
            </div>
        </div>

        <!-- Modifier Section -->
        <div class="w-full mb-2 p-2 border-2 border-gray-500 bg-[#909090] shadow-inner">
            <div class="text-center text-gray-800 font-bold mb-1">МОДИФИКАТОР СЛОЖНОСТИ</div>
            <div id="modifier-display"
                class="modifier-box w-full p-2 text-center text-xl mb-2 min-h-[3.5rem] flex items-center justify-center leading-tight">
                Нет условия
            </div>
            <button onclick="rollModifier()" class="mc-btn w-full py-1 text-lg hover:bg-gray-400">
                🎲 ДОБАВИТЬ ЧЕЛЛЕНДЖ
            </button>
        </div>

        <div id="pool-count" class="text-xs text-gray-500 mb-2">Загружено предметов: 0</div>

        <div class="text-center text-gray-600 text-lg">
            Версия базы: <span class="text-green-700 font-bold">1.21 (GIGA)</span>
        </div>
    </div>

    <!-- Modal for List -->
    <div id="list-modal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="mc-panel w-full max-w-4xl h-[80vh] flex flex-col relative">
            <div class="flex justify-between items-center mb-4 border-b-2 border-gray-600 pb-2">
                <h2 class="text-3xl text-gray-800" style="text-shadow: 2px 2px 0 #fff;">СПИСОК ПРЕДМЕТОВ</h2>
                <button onclick="toggleModal()" class="mc-btn px-4 py-1 text-xl bg-red-600 hover:bg-red-500">X</button>
            </div>

            <div class="flex gap-4 mb-4 items-center bg-gray-600 p-2 border-2 border-gray-800">
                <label class="flex items-center gap-2 text-white text-xl cursor-pointer select-none">
                    <input type="checkbox" id="filter-fast" onchange="renderList()"
                        class="w-6 h-6 rounded border-2 border-gray-800 text-green-600 focus:ring-0">
                    Только "Быстрая игра"
                </label>
                <input type="text" id="search-input" onkeyup="renderList()" placeholder="Поиск..."
                    class="ml-auto px-2 py-1 bg-gray-800 text-white border-2 border-gray-500 font-mono text-lg w-48">
            </div>

            <div id="modal-grid"
                class="flex-1 overflow-y-auto grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 p-2 bg-gray-800 border-inner shadow-inner">
                <!-- Items will be injected here -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast"
        class="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded shadow-lg border-2 border-green-800 hidden z-50">
        ID скопирован!
    </div>

    <script>
        // --- MODIFIERS LIST ---
        const modifiers = [
            "Без брони",
            "Без прыжков",
            "Только вид от 3-го лица (F5)",
            "Без использования сундуков",
            "Нельзя получать урон от падения",
            "Пацифист (никого не убивать)",
            "Без использования ведра воды",
            "FOV: 30 (Максимальное приближение)",
            "FOV: Quake Pro",
            "Без бега",
            "Только кожаная броня",
            "Пол — это лава",
            "Режим крота (не выходи на поверхность)",
            "Ночной житель (выходи только ночью)",
            "Без использования щита",
            "Вегетарианец",
            "Карнивор",
            "Без крафта инструментов",
            "Слепота (Яркость: Mood)",
            "Без звука",
            "Инверсия мыши",
            "Только 5 слотов хотбара",
            "Без использования верстака",
            "Нельзя использовать кровать",
            "Предмет во второй руке всегда",
            "Нельзя плавать",
            "Только золотые инструменты",
            "Нельзя использовать факелы",
            "Cinematic Camera (F8)",
            "Без регенерации",
            "Нельзя ломать землю/дерн",
            "Нельзя ломать дерево",
            "Только деревянные инструменты",
            "Инвентарь: 1 ряд",
            "Нельзя открывать инвентарь",
            "Чувствительность мыши: Max",
            "Чувствительность мыши: Min",
            "Без интерфейса (F1)",
            "Монохром",
            "Нельзя использовать печь"
        ];
    </script>
    <script src="items.js"></script>
    <script>
        // --- CORE FUNCTIONS ---
        const displayImg = document.getElementById('block-image');
        const displayName = document.getElementById('block-name');
        const displayId = document.getElementById('block-id');
        const displayType = document.getElementById('item-type');
        const rollBtn = document.getElementById('roll-btn');
        const rollFastBtn = document.getElementById('roll-fast-btn');
        const modifierDisplay = document.getElementById('modifier-display');
        let isRolling = false;

        let timerInterval;
        let startTime;
        let elapsedTime = 0;
        let isTimerRunning = false;

        function formatTime(ms) {
            let h = Math.floor(ms / 3600000);
            let m = Math.floor((ms % 3600000) / 60000).toString().padStart(2, '0');
            let s = Math.floor((ms % 60000) / 1000).toString().padStart(2, '0');
            let msDisplay = Math.floor((ms % 1000) / 10).toString().padStart(2, '0');

            if (h > 0) {
                return `${h}:${m}:${s}:${msDisplay}`;
            }
            return `${m}:${s}:${msDisplay}`;
        }

        function updateTimerDisplay() {
            const now = Date.now();
            const time = now - startTime + elapsedTime;
            document.getElementById('timer-display').innerText = formatTime(time);
        }

        function toggleTimer() {
            const btn = document.getElementById('timer-toggle-btn');
            if (isTimerRunning) {
                clearInterval(timerInterval);
                elapsedTime += Date.now() - startTime;
                isTimerRunning = false;
                btn.innerText = "СТАРТ";
            } else {
                startTime = Date.now();
                timerInterval = setInterval(updateTimerDisplay, 10);
                isTimerRunning = true;
                btn.innerText = "СТОП";
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            elapsedTime = 0;
            document.getElementById('timer-display').innerText = "00:00:00";
            const btn = document.getElementById('timer-toggle-btn');
            btn.innerText = "СТАРТ";
        }

        function triggerShake() {
            displayImg.classList.add('translate-y-1');
            setTimeout(() => displayImg.classList.remove('translate-y-1'), 50);
        }

        // Multiple fallback sources for images
        const MCMETA_ITEM = 'https://raw.githubusercontent.com/misode/mcmeta/assets/assets/minecraft/textures/item/';
        const MCMETA_BLOCK = 'https://raw.githubusercontent.com/misode/mcmeta/assets/assets/minecraft/textures/block/';
        const MINEATAR_CUBE = 'https://api.mineatar.io/cube/';
        const BARRIER_IMG = 'https://api.mineatar.io/cube/barrier';

        function tryLoadImage(imgElement, sources, index = 0) {
            if (index >= sources.length) {
                imgElement.src = BARRIER_IMG;
                imgElement.onerror = null;
                return;
            }
            imgElement.src = sources[index];
            imgElement.onerror = function () {
                tryLoadImage(imgElement, sources, index + 1);
            };
        }

        function getImageSources(item) {
            const id = item.id;
            const sources = [];

            // Primary source - minecraft-api.vercel.app (has 700+ items with pre-rendered icons)
            const MC_API = 'https://minecraft-api.vercel.app/images/items/';
            sources.push(MC_API + id + '.png');

            if (item.type === 'potion_effect') {
                sources.push(MCMETA_ITEM + (item.baseId || 'potion') + '.png');
                sources.push(MCMETA_ITEM + 'potion.png');
            } else if (item.type === 'block') {
                // For blocks: try mineatar cube, then mcmeta block textures
                sources.push(MINEATAR_CUBE + id);
                sources.push(MCMETA_BLOCK + id + '.png');
                sources.push(MCMETA_BLOCK + id + '_top.png');
                sources.push(MCMETA_ITEM + id + '.png');
            } else {
                // For items: try mcmeta item textures
                sources.push(MCMETA_ITEM + id + '.png');
                sources.push(MCMETA_BLOCK + id + '.png');
                sources.push(MINEATAR_CUBE + id);
            }

            return sources;
        }

        function updateDisplay(item) {
            displayName.innerText = item.name;

            if (item.type === 'potion_effect') {
                displayId.innerText = `minecraft:${item.baseId || item.id}`;
                displayType.innerText = 'ЭФФЕКТ';
                displayImg.style.transform = 'scale(0.9)';
            } else {
                displayId.innerText = `minecraft:${item.id}`;
                displayType.innerText = item.type === 'block' ? 'БЛОК' : 'ПРЕДМЕТ';
                displayImg.style.transform = item.type === 'block' ? 'scale(1)' : 'scale(0.9)';
            }

            const sources = getImageSources(item);
            tryLoadImage(displayImg, sources);
        }

        function startRoulette(mode) {
            if (isRolling) return;
            isRolling = true;
            const currentPool = (mode === 'fast') ? quickPool : pool;
            rollBtn.disabled = true;
            rollFastBtn.disabled = true;
            rollBtn.classList.add('opacity-50', 'cursor-not-allowed');
            rollFastBtn.classList.add('opacity-50', 'cursor-not-allowed');
            let counter = 0;
            let speed = 50;
            const totalRolls = 30;
            displayImg.classList.remove('pop-in');
            const loop = () => {
                const randomItem = currentPool[Math.floor(Math.random() * currentPool.length)];
                updateDisplay(randomItem);
                triggerShake();
                counter++;
                if (counter < totalRolls) {
                    if (counter > totalRolls - 10) speed += 30;
                    else if (counter > totalRolls - 5) speed += 60;
                    setTimeout(loop, speed);
                } else {
                    finalizeChoice(currentPool);
                }
            };
            loop();
        }

        function finalizeChoice(currentPool) {
            const finalItem = currentPool[Math.floor(Math.random() * currentPool.length)];
            updateDisplay(finalItem);
            displayImg.classList.add('pop-in');
            isRolling = false;
            rollBtn.disabled = false;
            rollFastBtn.disabled = false;
            rollBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            rollFastBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        function rollModifier() {
            let counter = 0;
            let speed = 50;
            const totalRolls = 15;
            const loop = () => {
                const randomMod = modifiers[Math.floor(Math.random() * modifiers.length)];
                modifierDisplay.innerText = randomMod;
                counter++;
                if (counter < totalRolls) {
                    speed += 15;
                    setTimeout(loop, speed);
                } else {
                    modifierDisplay.classList.add('pop-in');
                    setTimeout(() => modifierDisplay.classList.remove('pop-in'), 300);
                }
            };
            loop();
        }

        function copyId() {
            const text = displayId.innerText;
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.getElementById('toast');
                toast.classList.remove('hidden');
                setTimeout(() => { toast.classList.add('hidden'); }, 2000);
            });
        }

        function toggleModal() {
            const modal = document.getElementById('list-modal');
            const isHidden = modal.classList.contains('hidden');
            if (isHidden) {
                modal.classList.remove('hidden');
                renderList();
            } else {
                modal.classList.add('hidden');
            }
        }

        function renderList() {
            const grid = document.getElementById('modal-grid');
            const onlyFast = document.getElementById('filter-fast').checked;
            const search = document.getElementById('search-input').value.toLowerCase();
            let items = onlyFast ? quickPool : pool;
            if (search) {
                items = items.filter(i => i.name.toLowerCase().includes(search) || i.id.includes(search));
            }
            let html = '';
            items.forEach(item => {
                const sources = getImageSources(item);
                const iconUrl = sources[0] || BARRIER_IMG;
                const fallbackSources = JSON.stringify(sources.slice(1));
                html += `
                    <div class="flex flex-col items-center p-2 bg-gray-700 border border-gray-600 rounded hover:bg-gray-600 transition">
                        <img src="${iconUrl}" 
                             loading="lazy"
                             class="w-12 h-12 object-contain image-rendering-pixelated mb-1"
                             data-sources='${fallbackSources}'
                             data-idx="0"
                             onerror="
                                const srcs = JSON.parse(this.dataset.sources || '[]');
                                const idx = parseInt(this.dataset.idx || '0');
                                if (idx < srcs.length) {
                                    this.dataset.idx = idx + 1;
                                    this.src = srcs[idx];
                                } else {
                                    this.onerror = null;
                                    this.src = '${BARRIER_IMG}';
                                }
                             ">
                        <span class="text-center text-white text-sm leading-tight">${item.name}</span>
                    </div>
                `;
            });
            if (items.length === 0) {
                html = '<div class="col-span-full text-center text-white text-xl py-10">Ничего не найдено :(</div>';
            }
            grid.innerHTML = html;
        }
    </script>
</body>

</html>